function generate5MinsOHLCData(t,e,a,r,n){function s(t,e){var a=(isNaN(t)?1:t)*r,n=isNaN(e)?-.5:+e;return.01*Math.round(100*(Math.random()*a+a*n))}function i(t){if(!t)return Math.round(1e3*Math.random())+1e3;var e=Math.round(200*Math.random())-400;return Math.abs(t+e)}t=t instanceof Date?t:new Date(t);for(var o,c,d,l=new Date(t.getTime()),p=-1,g=[],m=a,h=i(n);++p<e;){var u=s();o=m+u,o<0&&(o=m-u),c=Math.max(m,o)+s(.2,0),d=Math.max(Math.min(m,o)-s(.2,0),0),h=i(h),g.push([l.getTime(),m,c,d,o,h]),m=o+s(1e-4),function(t){t.setTime(t.getTime()+3e5),t.getUTCHours()>18&&(t.setUTCDate(t.getUTCDate()+1),t.setUTCHours(9)),6==t.getUTCDay()?t.setUTCDate(t.getUTCDate()+2):0==t.getUTCDay()&&t.setUTCDate(t.getUTCDate()+1)}(l)}return{data:g,lastValue:m,lastDate:l,lastVolume:h}}function changeChart(){var t=$(this).find("option:selected"),e=t.val(),a=$(this).attr("data-action-type");"configurationType"==a?(chartConfiguration=e,stopStreaming(),createChart(initialPointsCount,chartConfiguration,getFunctionForCreateChart(chartType))):"initialPointsCount"==a?(initialPointsCount=e,stopStreaming(),createChart(initialPointsCount,chartConfiguration,getFunctionForCreateChart(chartType))):"streamPointsCount"==a?(streamPointsCount=e,removeStreamingStat(),isStreaming()&&(stopStreaming(),startStreaming())):"streamingInterval"==a&&(streamingInterval=e,removeStreamingStat(),isStreaming()&&(stopStreaming(),startStreaming()))}function getFunctionForCreateChart(t){switch(t){case"stock-ohlc":return execCreateStock}}function createChart(t,e,a){chart&&(chart.dispose(),chart=null,index=0,$("#anystock-speed-test-base-chart").empty()),isFirstInit||showPreloader(),setTimeout(function(){isFirstInit=!1,a(t,e)},1)}function execCreateStock(t,e){switch(rawData=generate5MinsOHLCData(new Date((new Date).getUTCFullYear()-4,0),t,100,10,100),perfMeter.start("Total"),perfMeter.start("Creating data storage"),dataTable=anychart.data.table(0),dataTable.addData(rawData.data),mainMapping=dataTable.mapAs(),mainMapping.addField("open",1,"first"),mainMapping.addField("high",2,"max"),mainMapping.addField("low",3,"min"),mainMapping.addField("close",4,"last"),mainMapping.addField("value",1,"first"),columnMapping=dataTable.mapAs(),columnMapping.addField("value",5,"sum"),scrollerMapping=dataTable.mapAs(),scrollerMapping.addField("value",4,"last"),perfMeter.end("Creating data storage"),perfMeter.start("Creating chart instance"),chart=anychart.stock(),chart.listen("chartDraw",function(){$("#loader-wrapper").remove(),hidePreloader()}),e){case"ohlc-basic":setBasicChartSettings("ohlc");break;case"ohlc-advanced":setAdvancedChartSettings("ohlc");break;case"candlestick-basic":setBasicChartSettings("candlestick");break;case"candlestick-advanced":setAdvancedChartSettings("candlestick");break;case"line-basic":setBasicChartSettings("line");break;case"spline-basic":setBasicChartSettings("spline");break;default:setBasicChartSettings()}chart.container("anystock-speed-test-base-chart"),perfMeter.end("Creating chart instance"),perfMeter.start("Chart rendering"),chart.draw(),rawData.data=null,perfMeter.end("Chart rendering"),perfMeter.end("Total");var a=$("#anystock-speed-test-base-result");a.empty(),a.append("<h5>Rendering "+addCommas(t)+" Data Points</h5>"),a.append(generateHTMLStatRecord("Creating data storage",perfMeter.get("Creating data storage"))),a.append(generateHTMLStatRecord("Creating chart instance",perfMeter.get("Creating chart instance"))),a.append(generateHTMLStatRecord("Chart rendering",perfMeter.get("Chart rendering"))),a.append(generateHTMLStatRecord("Total",perfMeter.get("Total")))}function setBasicChartSettings(t){chart.plot(0).defaultSeriesType(t),chart.plot(0).addSeries(mainMapping),chart.plot(0).getSeries(0).name("Main Series"),chart.padding(10,10,10,65),chart.scroller().line(scrollerMapping)}function setAdvancedChartSettings(t){chart.plot(0).defaultSeriesType(t),chart.plot(0).addSeries(mainMapping)[0].name("Main Series"),chart.plot(1).column(columnMapping).name("Column"),chart.padding(10,10,10,50),chart.plot(1).height("30%"),chart.plot(1).yAxis().labels().format(function(){var t=this.tickValue,e=t<0;return t=Math.abs(t),t/1e15>=1?(t/1e9).toFixed(0)+"Q":t/1e12>=1?(t/1e9).toFixed(0)+"T":t/1e9>=1?(t/1e9).toFixed(0)+"B":t/1e6>=1?(t/1e6).toFixed(0)+"M":t/1e3>=1?(t/1e3).toFixed(0)+"K":e?"-"+t:t}),chart.scroller().line(scrollerMapping)}function isStreaming(){return!isNaN(streamingTimerId)}function toggleStreaming(){isStreaming()?stopStreaming():startStreaming()}function startStreaming(){$("#start-base-chart-stream-btn").html("Stop Data Streaming"),streamingTimerId=setInterval(function(){function t(){if(rawData=generate5MinsOHLCData(rawData.lastDate,streamPointsCount,rawData.lastValue,10,rawData.lastVolume),perfMeter.start(streamPointsCount),dataTable.addData(rawData.data,!0),rawData.data=null,perfMeter.end(streamPointsCount),isNaN(streamingAverage)&&(streamingAverage=perfMeter.get(streamPointsCount)),$("#anystock-speed-test-stream-stat").length)streamingAverage=(streamingAverage+perfMeter.get(streamPointsCount))/2,$("#anystock-speed-test-stream-average .anystock-speed-test-result-row-value").html(Math.round(streamingAverage)+"ms");else{var t=$("#anystock-speed-test-base-result");t.append('<h5 id="anystock-speed-test-stream-stat">Streaming '+addCommas(streamPointsCount)+" Data Points</h5>"),t.append(generateHTMLStatRecord("Streaming interval",streamingInterval,void 0,"anystock-speed-test-stream-interval")),t.append(generateHTMLStatRecord("Average rendering time",Math.round(streamingAverage),void 0,"anystock-speed-test-stream-average"))}}requestAnimationFrame?requestAnimationFrame(t):t()},streamingInterval)}function stopStreaming(){isStreaming()&&(clearInterval(streamingTimerId),streamingTimerId=NaN),streamingAverage=NaN,$("#start-base-chart-stream-btn").html("Start Data Streaming")}function removeStreamingStat(){$("#anystock-speed-test-stream-stat").remove(),$("#anystock-speed-test-stream-interval").remove(),$("#anystock-speed-test-stream-average").remove()}function showPreloader(){$("#anystock-speed-test-base-chart").append('<div id="loader-wrapper-chart" class="anychart-loader"><div class="rotating-cover"><div class="rotating-plane"><div class="chart-row"><span class="chart-col green"></span><span class="chart-col orange"></span><span class="chart-col red"></span></div></div></div></div>')}function hidePreloader(){$("#loader-wrapper-chart").hide()}function generateHTMLStatRecord(t,e,a,r){return void 0===a&&(a="ms"),"<div "+(r=r?'id="'+r+'" ':"")+'class="anystock-speed-test-result-row clearfix"> <span class="anystock-speed-test-result-row-title">'+t+': </span><span class="anystock-speed-test-result-row-value">'+Math.round(e)+a+"</span></div>"}function addCommas(t){t+="",x=t.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var e=/(\d+)(\d{3})/;e.test(x1);)x1=x1.replace(e,"$1,$2");return x1+x2}!function(){var t=function(){this.started={},this.finished={}};t.prototype.start=function(t){this.started[t]=window.performance?window.performance.now():+new Date},t.prototype.end=function(t){var e=window.performance?window.performance.now():+new Date;this.finished[t]=e-(this.started[t]||e),delete this.started[t]},t.prototype.get=function(t){return this.finished[t]},t.prototype.print=function(t,e){console.group(t||"Performance log");for(var a=1;a<arguments.length;a++){var r=this.get(arguments[a]);r="number"==typeof r?r.toFixed(3):""+r,console.log(arguments[a]+": "+r+"ms")}console.groupEnd(t||"Performance log")},window.basePerfMeter=new t,window.perfMeter=new t}();var rawData,perfMeter,columnMapping,scrollerMapping,streamingTimerId,streamingAverage=NaN,isFirstInit=!0,chart,dataTable,chartConfiguration="ohlc-basic",initialPointsCount=5e4,streamPointsCount=500,streamingInterval=20,index=0,chartType=$("#anystock-speed-test-chartType-select").find("option:selected").attr("data-chart"),requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;anychart.onDocumentReady(function(){var t=$("#anystock-speed-test-base-result").width();$("#anystock-speed-test-base-chart").css({right:t+50}),$(".select").selectpicker(),$("#start-base-chart-stream-btn").click(toggleStreaming),createChart(initialPointsCount,chartConfiguration,execCreateStock),$(".select[data-action-type]").on("change",changeChart)});